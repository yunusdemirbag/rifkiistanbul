<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Anne Kedi Bakım Oyunu</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow: hidden;
            position: relative;
        }

        .game-window {
            width: 100vw;
            height: 100vh;
            max-width: 450px;
            max-height: 95vh;
            margin: 0 auto;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            border-radius: 15px;
            padding: 8px;
            box-shadow: 
                0 0 30px rgba(0,0,0,0.5),
                inset 0 0 20px rgba(255,255,255,0.1);
            position: relative;
            border: 6px solid #2d1b69;
            display: flex;
            flex-direction: column;
        }

        @media (min-width: 500px) {
            .game-window {
                width: 95vw;
                height: 95vh;
                margin: 2.5vh auto;
            }
        }

        @media (min-width: 768px) {
            .game-window {
                width: 500px;
                height: 800px;
                margin: 10vh auto;
            }
        }

        .game-header {
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            color: white;
            text-align: center;
            padding: 8px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        @media (min-width: 768px) {
            .game-header {
                padding: 12px;
                font-size: 20px;
            }
        }

        .game-container {
            flex: 1;
            position: relative;
            background-image: url('oda.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.3);
        }

        .husnanur {
            width: 144px;
            height: 180px;
            background-image: url('husnanur.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            cursor: pointer;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            transition: transform 0.3s ease;
        }

        @media (min-width: 768px) {
            .husnanur {
                width: 150px;
                height: 180px;
                bottom: 60px;
            }
        }

        .husnanur:hover {
            transform: scale(1.05);
        }

        .name-tag {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap;
            border: 2px solid #FFD700;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .kedi {
            width: 60px;
            height: 60px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            cursor: pointer;
            z-index: 5;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            position: absolute;
            transition: all 0.3s ease;
        }

        @media (min-width: 768px) {
            .kedi {
                width: 80px;
                height: 80px;
            }
        }

        .rifki {
            background-image: url('rifki.png');
        }

        .istanbul {
            background-image: url('istanbul.png');
        }

        .kedi:hover {
            transform: scale(1.1);
        }

        .hud {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.9);
            color: #FFD700;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: bold;
            z-index: 100;
            border: 2px solid #FFD700;
            min-width: 100px;
        }

        @media (min-width: 768px) {
            .hud {
                font-size: 14px;
                padding: 12px;
            }
        }

        .character {
            transition: all 0.3s ease;
            user-select: none;
            -webkit-user-select: none;
        }

        .item {
            width: 50px;
            height: 50px;
            position: absolute;
            cursor: move;
            z-index: 15;
            transition: transform 0.2s ease;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        @media (min-width: 768px) {
            .item {
                width: 70px;
                height: 70px;
            }
        }

        .item:hover {
            transform: scale(1.1);
        }

        .item.dragging {
            transform: scale(1.2);
            z-index: 20;
            transition: none;
        }

        .mama-kabi {
            background-image: url('mama.png');
            bottom: 20px;
            left: 20px;
        }

        .su-kabi {
            background-image: url('su.png');
            bottom: 20px;
            left: 80px;
        }

        @media (min-width: 768px) {
            .mama-kabi {
                bottom: 60px;
                left: 20px;
            }
            
            .su-kabi {
                bottom: 60px;
                left: 100px;
            }
        }

        .speech-bubble {
            position: absolute;
            background: white;
            border: 3px solid #333;
            border-radius: 12px;
            padding: 8px 12px;
            font-size: 11px;
            font-weight: bold;
            max-width: 120px;
            word-wrap: break-word;
            z-index: 25;
            animation: popIn 0.3s ease;
            box-shadow: 
                2px 2px 0px rgba(0,0,0,0.3),
                inset 1px 1px 2px rgba(255,255,255,0.8);
            top: -70px;
            left: 50%;
            transform: translateX(-50%);
        }

        @media (min-width: 768px) {
            .speech-bubble {
                border: 4px solid #333;
                border-radius: 15px;
                padding: 10px 15px;
                font-size: 13px;
                max-width: 140px;
                top: -80px;
            }
        }

        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid white;
            filter: drop-shadow(0px 2px 0px rgba(0,0,0,0.3));
        }

        @media (min-width: 768px) {
            .speech-bubble::after {
                bottom: -12px;
                border-left: 12px solid transparent;
                border-right: 12px solid transparent;
                border-top: 12px solid white;
            }
        }

        @keyframes popIn {
            0% { 
                transform: translateX(-50%) scale(0) rotate(-5deg); 
                opacity: 0; 
            }
            80% { 
                transform: translateX(-50%) scale(1.1) rotate(2deg); 
                opacity: 1; 
            }
            100% { 
                transform: translateX(-50%) scale(1) rotate(0deg); 
                opacity: 1; 
            }
        }

        .kedi-istek {
            background: linear-gradient(145deg, #FFE4E1, #FFC0CB);
            color: #8B0000;
            border-color: #8B0000;
        }

        .anne-cevap {
            background: linear-gradient(145deg, #E6F3FF, #B0E0E6);
            color: #000080;
            border-color: #000080;
        }

        .basarili {
            background: linear-gradient(145deg, #90EE90, #98FB98);
            color: #006400;
            border-color: #006400;
        }

        .hatali {
            background: linear-gradient(145deg, #FFB6C1, #FFA0B4);
            color: #8B0000;
            border-color: #8B0000;
        }

        .ozur {
            background: linear-gradient(145deg, #D8BFD8, #DDA0DD);
            color: #4B0082;
            border-color: #4B0082;
        }

        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(145deg, rgba(0,0,0,0.95), rgba(20,20,20,0.95));
            color: #FFD700;
            padding: 20px;
            border-radius: 15px;
            border: 3px solid #FFD700;
            text-align: center;
            z-index: 100;
            display: none;
            box-shadow: 
                5px 5px 0px rgba(0,0,0,0.5),
                inset 2px 2px 4px rgba(255,215,0,0.3);
            max-width: 90%;
        }

        @media (min-width: 768px) {
            .game-over {
                padding: 30px;
                border: 4px solid #FFD700;
            }
        }

        .restart-btn {
            background: linear-gradient(145deg, #4CAF50, #45a049);
            color: white;
            border: 3px solid #2E7D32;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
            box-shadow: 
                3px 3px 0px rgba(0,0,0,0.3),
                inset 1px 1px 2px rgba(255,255,255,0.3);
        }

        @media (min-width: 768px) {
            .restart-btn {
                padding: 12px 24px;
                font-size: 16px;
            }
        }

        .restart-btn:hover {
            background: linear-gradient(145deg, #45a049, #4CAF50);
            transform: translateY(-2px);
            box-shadow: 
                5px 5px 0px rgba(0,0,0,0.3),
                inset 1px 1px 2px rgba(255,255,255,0.3);
        }

        /* Kediler için giriş animasyonu */
        @keyframes kediBelir {
            0% { 
                opacity: 0; 
                transform: scale(0) rotate(180deg); 
            }
            50% { 
                opacity: 0.5; 
                transform: scale(1.3) rotate(90deg); 
            }
            100% { 
                opacity: 1; 
                transform: scale(1) rotate(0deg); 
            }
        }

        .kedi.yeni-pozisyon {
            animation: kediBelir 0.8s ease-out;
        }

        /* Touch iyileştirmeleri */
        .item, .kedi, .husnanur {
            touch-action: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* Mobil için daha büyük dokunma alanları */
        @media (max-width: 767px) {
            .item {
                padding: 10px;
                margin: -10px;
            }
            
            .kedi {
                padding: 15px;
                margin: -15px;
            }
        }

        /* Mobil klavye için viewport düzeltmesi */
        @media screen and (max-height: 500px) {
            .game-window {
                height: 100vh;
                margin: 0 auto;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">Nurella Kids - Kedi Bakım Oyunu</div>
    <div class="game-window">
        <div class="game-header">Anne Kedi Bakım Oyunu</div>
        <div class="game-container">
            <div class="husnanur character">
                <div class="name-tag">Husnanur</div>
            </div>
            <div class="rifki kedi character">
                <div class="name-tag">Rıfkı</div>
            </div>
            <div class="istanbul kedi character">
                <div class="name-tag">İstanbul</div>
            </div>
            
            <div class="mama-kabi item" draggable="true"></div>
            <div class="su-kabi item" draggable="true"></div>

            <div class="hud">
                <div>Skor: <span id="skor">0</span></div>
                <div>Süre: <span id="sure">30</span>s</div>
                <div>Seviye: <span id="seviye">1</span></div>
            </div>

            <div class="game-over" id="gameOver">
                <h2>ANNEEEEEG!</h2>
                <p>Oyun Bitti!</p>
                <p>Final Skoru: <span id="finalSkor">0</span></p>
                <button class="restart-btn" onclick="yeniOyun()">Yeniden Başla</button>
            </div>
        </div>
    </div>

    <script>
        let skor = 0;
        let sure = 30;
        let seviye = 1;
        let oyunAktif = false;
        let draggedElement = null;
        let kullanilmisPozisyonlar = [];
        let kedilerinIstekleri = {};
        let oyunBasladi = false;
        let istekTimers = {}; // Her kedi için timer takibi
        // Her kedi için son istek türünü tutacak obje
        let sonIstekTuru = { rifki: null, istanbul: null };
        let karsilananIstekSayisi = 0;

        // Mobilde sürükleme için değişkenler
        let isDragging = false;
        let currentDragElement = null;
        let touchStartX = 0;
        let touchStartY = 0;
        let touchOffsetX = 0;
        let touchOffsetY = 0;

        // Mama ve su kabı orijinal pozisyonları
        let orijinalPozisyonlar = {};

        const kediler = ['rifki', 'istanbul'];
        const kediElementleri = {
            rifki: document.querySelector('.rifki'),
            istanbul: document.querySelector('.istanbul')
        };

        // Kedilerin belireceği pozisyonlar - responsive
        function getPozisyonAlanlari() {
            const gameContainer = document.querySelector('.game-container');
            const containerWidth = gameContainer ? gameContainer.offsetWidth : 400;
            const containerHeight = gameContainer ? gameContainer.offsetHeight : 600;
            
            // Mobil ve tablet için pozisyonları dinamik olarak ayarla
            if (window.innerWidth < 768) {
                return [
                    { x: 30, y: 60, isim: 'pencere-kenari-1' },
                    { x: 100, y: 60, isim: 'pencere-kenari-2' },
                    { x: 170, y: 80, isim: 'komidin-ustu' },
                    { x: 220, y: 110, isim: 'dolap-ustu-1' },
                    { x: 150, y: 110, isim: 'dolap-ustu-2' },
                    { x: 30, y: 140, isim: 'yatak-ustu-1' },
                    { x: 90, y: 140, isim: 'yatak-ustu-2' },
                    { x: 140, y: 140, isim: 'yatak-ustu-3' },
                    { x: 180, y: 180, isim: 'yatak-kenari' },
                    { x: 30, y: 220, isim: 'hali-ustu-1' },
                    { x: 90, y: 220, isim: 'hali-ustu-2' },
                    { x: 150, y: 220, isim: 'hali-ustu-3' },
                    { x: 210, y: 220, isim: 'hali-ustu-4' },
                    { x: 30, y: 280, isim: 'hali-kenari-1' },
                    { x: 90, y: 280, isim: 'hali-kenari-2' },
                    { x: 150, y: 280, isim: 'hali-kenari-3' },
                    { x: 210, y: 280, isim: 'hali-kenari-4' },
                    { x: 270, y: 280, isim: 'hali-kenari-5' },
                    { x: 60, y: 350, isim: 'oda-zemini-1' },
                    { x: 120, y: 350, isim: 'oda-zemini-2' },
                    { x: 180, y: 350, isim: 'oda-zemini-3' },
                    { x: 240, y: 350, isim: 'oda-zemini-4' }
                ];
            } else {
                return [
                    { x: 50, y: 80, isim: 'pencere-kenari-1' },
                    { x: 150, y: 80, isim: 'pencere-kenari-2' },
                    { x: 250, y: 100, isim: 'komidin-ustu' },
                    { x: 300, y: 150, isim: 'dolap-ustu-1' },
                    { x: 220, y: 150, isim: 'dolap-ustu-2' },
                    { x: 50, y: 170, isim: 'yatak-ustu-1' },
                    { x: 130, y: 170, isim: 'yatak-ustu-2' },
                    { x: 190, y: 170, isim: 'yatak-ustu-3' },
                    { x: 230, y: 230, isim: 'yatak-kenari' },
                    { x: 50, y: 270, isim: 'hali-ustu-1' },
                    { x: 130, y: 270, isim: 'hali-ustu-2' },
                    { x: 210, y: 270, isim: 'hali-ustu-3' },
                    { x: 290, y: 270, isim: 'hali-ustu-4' },
                    { x: 50, y: 350, isim: 'hali-kenari-1' },
                    { x: 130, y: 350, isim: 'hali-kenari-2' },
                    { x: 210, y: 350, isim: 'hali-kenari-3' },
                    { x: 290, y: 350, isim: 'hali-kenari-4' },
                    { x: 370, y: 350, isim: 'hali-kenari-5' },
                    { x: 90, y: 430, isim: 'oda-zemini-1' },
                    { x: 170, y: 430, isim: 'oda-zemini-2' },
                    { x: 250, y: 430, isim: 'oda-zemini-3' },
                    { x: 330, y: 430, isim: 'oda-zemini-4' }
                ];
            }
        }

        const istekMesajlari = {
            acikti: [
                "Anne çok acıktım hadi! miyav miyav",
                "Anne karnım gurulduyor, acil MAMA!",
                "Miyav miyav! Anne çok acım var, MAMA istiyorum!",
                "Anne lütfen MAMA ver, ölüyorum açlıktan!",
                "Miyav! Anne acıktım çok çok! MAMA!",
                "Anne MAMA istiyorum lütfen!",
                "Karnım boş anne, hemen MAMA getir!",
                "Miyav miyav anne, MAMA zamanı geldi!",
                "Anne çok aç kaldım, MAMA ver bana!",
                "MAMA MAMA MAMA! Anne çok istiyorum!",
                "Anne benim midem ses çıkarıyor, MAMA!",
                "Miyav anne, güzel MAMA istiyorum!",
                "Anne acıktım ya, hemen MAMA getir!",
                "Anne çok acıktım hadi, MAMA ver!",
                "Anne çok çok acıktım, MAMA lütfen!"
            ],
            susadi: [
                "Anne susadım acil SU istiyorum!",
                "Miyav miyav! SU istiyorum anne!",
                "Anne çok susadım, dilim kurudu! SU!",
                "SU ver anne, miyav miyav hadi!",
                "Anne susuzluktan ölüyorum! SU!",
                "Miyav! Anne SU getir bana!",
                "Anne çok susadım hadi! SU!",
                "SU istiyorum anne, çok susadım!",
                "Anne ağzım çok kurudu, SU ver!",
                "Miyav miyav! Taze SU istiyorum!",
                "Anne susuzluk beni bitirdi, SU!",
                "SU SU SU! Anne hemen getir!",
                "Anne çok susadım ya, soğuk SU!",
                "Miyav anne, temiz SU istiyorum!",
                "Anne SU ver bana, çok susadım!"
            ]
        };

        const anneCevaplari = {
            bekle: [
                "Tamam yavrum bekle biraz",
                "Hemen geliyorum canım benim",
                "Sabret biraz tatlı kedim",
                "Anne geliyor, endişelenme",
                "Bir dakika canım, hemen",
                "Tamam aşkım, anne hallediyor",
                "Bekle tatlım, anne getiyor",
                "Sabırlı ol canım, geliyorum",
                "Tamam Rifki getiriyorum oğlum",
                "Tamam İstanbul'cum bekle anniş geliyor",
                "Hemen geliyorum Rifki canım",
                "Sabret İstanbul tatlım, anne geliyor",
                "Bir dakika Rifki'ciğim, hemen",
                "Tamam İstanbul bekle biraz"
            ],
            basarili: [
                "Teşekkürler anniş, seni çok seviyorum!",
                "Turuncu saçlı annem benim harikasın!",
                "Lilyum gibi kokuyorsun anne, Lilyumlar seni görse bana benziyorsun derdi anne teşekkürler!",
                "Çok uzak kaldık anniş, bir daha bu kadar uzak kalma bizden!",
                "Aferin anne! Çok iyi bakıyorsun bize anniş!",
                "Seni çok seviyorum anne canım!",
                "En iyi anne sensin dünyada anniş!",
                "Teşekkürler anne, çok lezzetli oldu!",
                "Miyav miyav! Süpersin anniş!",
                "Anne sen çok iyisin, seni seviyorum!",
                "Vay be anne, tam istediğim gibi!",
                "Anniş sen mükemmelsin, teşekkürler!",
                "Sen bu dünyadaki en güzel kediciğimsin anniş!",
                "Anne benim güzel annem, çok teşekkürler!",
                "Anniş sen çok tatlısın, seni öpüyorum!",
                "Lilyumdan da güzelsin Annem!"
            ],
            hatali: [
                "Anne ne yapıyorsun sen öyle? Ben MAMA istemiştim!",
                "Bu ne ya anne, ben SU istemiştim! MIYAAAAV!",
                "Anne kafan mı karıştı tatlım? Ben bunu istememiştim!",
                "MIYAAAAV MIYAAAAV! Yanlış şey bu anne!",
                "Anne dikkatli ol biraz! Ben bunu istememiştim!",
                "Ee anne, bu MAMA değil ki! Ben MAMA istemiştim!",
                "Anne sen karıştırdın galiba! MIYAAAAV!",
                "MIYAAAAV! Anne bu istediğim değil! Ben SU istemiştim!",
                "Anniş bu yanlış, ben başka şey istemiştim! MIYAAAAV!",
                "Anne ne yaptın ya, karıştırdın! Ben SU istemiştim!",
                "Bu SU değil anne, MAMA istemiştim! MIYAAAAV!",
                "Anniş dikkat et, yanlış verdin! Ben bunu istemiyorum!"
            ],
            ozur: [
                "Ay özür dilerim canım, hemen doğrusunu getiriyorum!",
                "Anniş çok özür diler, kafam karıştı!",
                "Haklısın tatlım, anne yanlış yaptı, hemen düzeltiyorum!",
                "Vay be, anne yanlış getirdi, hemen doğrusunu alıyorum!",
                "Çok haklısın, anne dalgın bugün, özür dilerim!",
                "Ay pardon canım kedim, hemen istediğini getiriyorum!",
                "Anniş çok üzgün, hemen doğrusunu getireceğim!",
                "Haklısın minik kedim, anne hata yaptı!",
                "Özür dilerim canım, hemen düzeltiyorum!"
            ],
            afiyet: [
                "Afiyet olsun canım benim!",
                "Oh ne güzel, afiyet bal şeker olsun!",
                "Afiyet olsun tatlı kedim, sevgiyle ye!",
                "Güzel kedim benim, afiyet olsun sana!",
                "Afiyetle ye canım, anne seni çok seviyor!",
                "Afiyet olsun minik patilerim!",
                "Annenin güzel kedisi, afiyet şeker olsun!",
                "Ye bakalım güzelim, afiyet olsun!",
                "Afiyet olsun canım, daha ister misin?",
                "Afiyetler olsun tatlı kediciğim!",
                "Annenin canı, afiyet olsun sana!",
                "Oh oh, afiyet olsun minik yavrum!"
            ]
        };

        function rastgelePozisyon(element, kediAdi = null) {
            const pozisyonAlanlari = getPozisyonAlanlari();
            let uygunPozisyonlar = pozisyonAlanlari.filter(p => !kullanilmisPozisyonlar.includes(p.isim));
            
            if (uygunPozisyonlar.length === 0) {
                kullanilmisPozisyonlar = [];
                uygunPozisyonlar = pozisyonAlanlari;
            }
            
            // Diğer kedinin pozisyonunu al
            let digerKediPozisyonu = null;
            if (kediAdi) {
                const digerKedi = kediAdi === 'rifki' ? 'istanbul' : 'rifki';
                const digerKediEl = kediElementleri[digerKedi];
                if (digerKediEl) {
                    digerKediPozisyonu = {
                        x: parseInt(digerKediEl.style.left || '0'),
                        y: parseInt(digerKediEl.style.top || '0')
                    };
                }
            }
            
            // Eğer diğer kedi varsa, ona yakın pozisyonları eliyoruz
            if (digerKediPozisyonu) {
                uygunPozisyonlar = uygunPozisyonlar.filter(p => {
                    const dx = p.x - digerKediPozisyonu.x;
                    const dy = p.y - digerKediPozisyonu.y;
                    const mesafe = Math.sqrt(dx*dx + dy*dy);
                    return mesafe > 80; // 80px ve altı yakınlıkları ele
                });
                // Eğer hiç uygun pozisyon kalmazsa, tüm pozisyonlardan seç
                if (uygunPozisyonlar.length === 0) {
                    uygunPozisyonlar = pozisyonAlanlari;
                }
            }
            
            const randomIndex = Math.floor(Math.random() * uygunPozisyonlar.length);
            const secilenPozisyon = uygunPozisyonlar[randomIndex];
            
            kullanilmisPozisyonlar.push(secilenPozisyon.isim);
            
            // Oyun alanı sınırlarını kontrol et - mor çerçeveyi geçmesin
            const gameContainer = document.querySelector('.game-container');
            const maxX = gameContainer.offsetWidth - element.offsetWidth - 20; // 20px kenar boşluğu
            const maxY = gameContainer.offsetHeight - element.offsetHeight - 60; // 60px alt boşluk (header için)
            
            let x = Math.max(20, Math.min(secilenPozisyon.x, maxX));
            let y = Math.max(60, Math.min(secilenPozisyon.y, maxY));
            
            element.style.left = x + 'px';
            element.style.top = y + 'px';
            element.classList.add('yeni-pozisyon');
            
            setTimeout(() => {
                element.classList.remove('yeni-pozisyon');
            }, 800);
        }

        function yeniIstek(kedi) {
            if (!oyunAktif) return;
            
            const kediElement = kediElementleri[kedi];
            
            // Eğer kedinin zaten aktif bir isteği varsa, yeni istek oluşturma
            if (kedilerinIstekleri[kedi]) return;
            
            // Yeni pozisyon ver
            rastgelePozisyon(kediElement, kedi);
            
            // Pozisyon animasyonu bittikten sonra istek ver
            setTimeout(() => {
                if (!oyunAktif || kedilerinIstekleri[kedi]) return;
                
                // Son istekle aynı olmasın diye rastgele istek türü seçimi
                let istekTuru;
                do {
                    istekTuru = Math.random() < 0.5 ? 'acikti' : 'susadi';
                } while (sonIstekTuru[kedi] === istekTuru && Math.random() < 0.7); // %70 aynı gelmesin
                sonIstekTuru[kedi] = istekTuru;
                kedilerinIstekleri[kedi] = istekTuru;
                
                // Rastgele bir mesaj seç
                const mesajlar = istekMesajlari[istekTuru];
                const mesaj = mesajlar[Math.floor(Math.random() * mesajlar.length)];
                
                // Konuşma balonu oluştur
                konusmaBalonuOlustur(kediElement, mesaj, 'kedi-istek');
                
                // Anne cevap versin
                setTimeout(() => {
                    if (!oyunAktif) return;
                    const anneElement = document.querySelector('.husnanur');
                    const anneMesaj = anneCevaplari.bekle[Math.floor(Math.random() * anneCevaplari.bekle.length)];
                    konusmaBalonuOlustur(anneElement, anneMesaj, 'anne-cevap');
                }, 1000);

                // Hız ayarı: karşılanan istek sayısına göre tekrar süresi
                let tekrarSuresi = 2000;
                if (karsilananIstekSayisi >= 60) {
                    tekrarSuresi = 700;
                } else if (karsilananIstekSayisi >= 40) {
                    tekrarSuresi = 1100;
                } else if (karsilananIstekSayisi >= 10) {
                    tekrarSuresi = 1500;
                }
                // Eğer istek karşılanmazsa tekrar tekrar istemeye devam etsin
                let tekrarIstek = () => {
                    if (!oyunAktif) return;
                    if (kedilerinIstekleri[kedi]) {
                        // Hala istek karşılanmadıysa tekrar balon göster
                        const yeniMesaj = mesajlar[Math.floor(Math.random() * mesajlar.length)];
                        konusmaBalonuOlustur(kediElement, yeniMesaj, 'kedi-istek');
                        setTimeout(tekrarIstek, tekrarSuresi);
                    }
                };
                setTimeout(tekrarIstek, tekrarSuresi);
            }, 900);
        }

        function konusmaBalonuOlustur(element, mesaj, tip) {
            // Eğer zaten bir konuşma balonu varsa, onu kaldır
            const mevcutBalon = element.querySelector('.speech-bubble');
            if (mevcutBalon) {
                element.removeChild(mevcutBalon);
            }

            const balloon = document.createElement('div');
            balloon.className = `speech-bubble ${tip}`;
            balloon.textContent = mesaj;
            
            // Husnanur için balon daha aşağıda olsun
            if (element.classList.contains('husnanur')) {
                balloon.style.top = '-70px'; // Karakterin hemen üstü
            } else {
                balloon.style.top = '-110px'; // Diğer karakterler için daha yukarı
            }
            balloon.style.left = '50%';
            balloon.style.transform = 'translateX(-50%)';
            
            element.appendChild(balloon);
            
            // Balonun ekranda kalma süresi
            let sure = 1500; // Varsayılan 1.5 saniye
            if (tip === 'basarili') {
                sure = 3000; // Teşekkür (başarılı) balonu 3 saniye
            }
            
            // Balonun pozisyonunu kontrol et ve düzelt - mor çerçeveyi geçmesin
            setTimeout(() => {
                const gameContainer = document.querySelector('.game-container');
                const containerRect = gameContainer.getBoundingClientRect();
                const balloonRect = balloon.getBoundingClientRect();
                
                let shiftX = 0;
                let shiftY = 0;
                
                // Sol sınır kontrolü
                if (balloonRect.left < containerRect.left + 10) {
                    shiftX = containerRect.left + 10 - balloonRect.left;
                }
                // Sağ sınır kontrolü
                else if (balloonRect.right > containerRect.right - 10) {
                    shiftX = containerRect.right - 10 - balloonRect.right;
                }
                
                // Üst sınır kontrolü (header'ı geçmesin)
                if (balloonRect.top < containerRect.top + 60) {
                    shiftY = containerRect.top + 60 - balloonRect.top;
                }
                
                // Alt sınır kontrolü
                if (balloonRect.bottom > containerRect.bottom - 10) {
                    shiftY = containerRect.bottom - 10 - balloonRect.bottom;
                }
                
                if (shiftX !== 0 || shiftY !== 0) {
                    balloon.style.transform = `translateX(calc(-50% + ${shiftX}px)) translateY(${shiftY}px)`;
                }
            }, 10);
            
            setTimeout(() => {
                if (balloon.parentNode === element) {
                    element.removeChild(balloon);
                }
            }, sure);
        }

        function kediTikla(e) {
            if (!oyunAktif) return;
            const kedi = this.classList.contains('rifki') ? 'rifki' : 'istanbul';
            
            // Eğer kedinin bir isteği yoksa yeni istek ver
            if (!kedilerinIstekleri[kedi]) {
                yeniIstek(kedi);
            }
        }

        // Yeni mobil odaklı sürükleme sistemi
        function handleTouchStart(e) {
            if (!oyunAktif) return;
            
            e.preventDefault();
            e.stopPropagation();
            
            const touch = e.touches[0];
            const element = e.currentTarget;
            
            isDragging = true;
            currentDragElement = element;
            
            // Element pozisyonunu al
            const rect = element.getBoundingClientRect();
            const containerRect = document.querySelector('.game-container').getBoundingClientRect();
            
            touchOffsetX = touch.clientX - rect.left;
            touchOffsetY = touch.clientY - rect.top;
            
            element.classList.add('dragging');
            
            // Elementin z-index'ini artır
            element.style.zIndex = '30';
        }

        function handleTouchMove(e) {
            if (!isDragging || !currentDragElement || !oyunAktif) return;
            
            e.preventDefault();
            e.stopPropagation();
            
            const touch = e.touches[0];
            const gameContainer = document.querySelector('.game-container');
            const containerRect = gameContainer.getBoundingClientRect();
            
            // Yeni pozisyonu hesapla
            let newX = touch.clientX - containerRect.left - touchOffsetX;
            let newY = touch.clientY - containerRect.top - touchOffsetY;
            
            // Sınırları kontrol et
            const elementWidth = currentDragElement.offsetWidth;
            const elementHeight = currentDragElement.offsetHeight;
            
            newX = Math.max(0, Math.min(newX, containerRect.width - elementWidth));
            newY = Math.max(0, Math.min(newY, containerRect.height - elementHeight));
            
            // Elementi hareket ettir
            currentDragElement.style.left = newX + 'px';
            currentDragElement.style.top = newY + 'px';
            currentDragElement.style.bottom = 'auto';
            
            // Kediler üzerinde mi kontrol et (gerçek zamanlı)
            checkDropOnKedi(touch.clientX, touch.clientY);
        }

        function handleTouchEnd(e) {
            if (!isDragging || !currentDragElement) return;
            
            e.preventDefault();
            e.stopPropagation();
            
            // Sürükleme işlemini sonlandır
            currentDragElement.classList.remove('dragging');
            currentDragElement.style.zIndex = '15';
            
            // Elementi hemen orijinal yerine döndür
            resetItemPosition(currentDragElement);
            
            isDragging = false;
            currentDragElement = null;
        }

        function checkDropOnKedi(clientX, clientY) {
            if (!currentDragElement) return;
            
            // Hangi kedinin üzerinde olduğunu kontrol et
            const elementsAtPoint = document.elementsFromPoint(clientX, clientY);
            let droppedOnKedi = null;
            
            for (let el of elementsAtPoint) {
                if (el.classList.contains('kedi')) {
                    droppedOnKedi = el;
                    break;
                }
            }
            
            // Eğer kedi üzerine geldiysek işlemi gerçekleştir
            if (droppedOnKedi) {
                handleDrop(droppedOnKedi, currentDragElement);
                
                // Elementi hemen yerine döndür
                currentDragElement.classList.remove('dragging');
                currentDragElement.style.zIndex = '15';
                resetItemPosition(currentDragElement);
                
                // Sürükleme işlemini sonlandır
                isDragging = false;
                currentDragElement = null;
            }
        }

        function resetItemPosition(element) {
            if (element.classList.contains('mama-kabi')) {
                element.style.left = '20px';
                element.style.top = 'auto';
                if (window.innerWidth >= 768) {
                    element.style.bottom = '60px';
                } else {
                    element.style.bottom = '20px';
                }
            } else if (element.classList.contains('su-kabi')) {
                if (window.innerWidth >= 768) {
                    element.style.left = '100px';
                    element.style.bottom = '60px';
                } else {
                    element.style.left = '80px';
                    element.style.bottom = '20px';
                }
                element.style.top = 'auto';
            }
        }

        function handleDrop(kediElement, draggedItem) {
            const kedi = kediElement.classList.contains('rifki') ? 'rifki' : 'istanbul';
            const istekTuru = kedilerinIstekleri[kedi];
            
            // Eğer kedinin bir isteği yoksa, bir şey yapma
            if (!istekTuru) return;
            
            let dogruCevap = false;
            let yanlisCevap = false;
            
            // Doğru eşleşme kontrolü
            if (draggedItem.classList.contains('mama-kabi') && istekTuru === 'acikti') {
                dogruCevap = true;
            } else if (draggedItem.classList.contains('su-kabi') && istekTuru === 'susadi') {
                dogruCevap = true;
            } else {
                yanlisCevap = true;
            }
            
            if (dogruCevap) {
                // Doğru eşleşme durumunda
                const basariliMesaj = anneCevaplari.basarili[Math.floor(Math.random() * anneCevaplari.basarili.length)];
                konusmaBalonuOlustur(kediElement, basariliMesaj, 'basarili');
                
                // Anne afiyet olsun desin
                setTimeout(() => {
                    if (!oyunAktif) return;
                    const anneElement = document.querySelector('.husnanur');
                    const afiyetMesaj = anneCevaplari.afiyet[Math.floor(Math.random() * anneCevaplari.afiyet.length)];
                    konusmaBalonuOlustur(anneElement, afiyetMesaj, 'anne-cevap');
                }, 1500);
                
                // Skoru artır
                skor += 10 * seviye;
                document.getElementById('skor').textContent = skor;
                
                // Süreyi artır
                sure += 5;
                document.getElementById('sure').textContent = sure;
                
                // İsteği sıfırla
                delete kedilerinIstekleri[kedi];
                
                // Bu kedinin timer'ını da temizle
                if (istekTimers[kedi]) {
                    clearTimeout(istekTimers[kedi]);
                    delete istekTimers[kedi];
                }
                
                // Teşekkür ettikten hemen sonra yeni istek gelsin
                setTimeout(() => {
                    if (oyunAktif) yeniIstek(kedi);
                }, 1600);
                
                karsilananIstekSayisi++;
            } else if (yanlisCevap) {
                // Yanlış eşleşme durumunda
                const hataliMesaj = anneCevaplari.hatali[Math.floor(Math.random() * anneCevaplari.hatali.length)];
                konusmaBalonuOlustur(kediElement, hataliMesaj, 'hatali');
                
                // Anne özür dilesin
                setTimeout(() => {
                    if (!oyunAktif) return;
                    const anneElement = document.querySelector('.husnanur');
                    const ozurMesaj = anneCevaplari.ozur[Math.floor(Math.random() * anneCevaplari.ozur.length)];
                    konusmaBalonuOlustur(anneElement, ozurMesaj, 'ozur');
                }, 1500);
                
                // Skoru azalt
                skor = Math.max(0, skor - 5);
                document.getElementById('skor').textContent = skor;
                
                // Süreyi azalt
                sure = Math.max(1, sure - 2);
                document.getElementById('sure').textContent = sure;
            }
        }

        // Eski sürükleme fonksiyonlarını kaldır ve yenilerini ekle
        function dragStart(e) {
            // Sadece mouse için
            if (e.type === 'mousedown' && !oyunAktif) return;
            
            isDragging = true;
            currentDragElement = this;
            this.classList.add('dragging');
            this.style.zIndex = '30';
        }

        function drag(e) {
            // Sadece mouse için
            if (e.type === 'mousemove' && isDragging && currentDragElement && oyunAktif) {
                e.preventDefault();
                
                const gameContainer = document.querySelector('.game-container');
                const containerRect = gameContainer.getBoundingClientRect();
                
                // Pozisyonu hesapla
                let left = e.clientX - containerRect.left - (currentDragElement.offsetWidth / 2);
                let top = e.clientY - containerRect.top - (currentDragElement.offsetHeight / 2);
                
                // Sınırları kontrol et
                left = Math.max(0, Math.min(left, containerRect.width - currentDragElement.offsetWidth));
                top = Math.max(0, Math.min(top, containerRect.height - currentDragElement.offsetHeight));
                
                // Pozisyonu ayarla
                currentDragElement.style.left = left + 'px';
                currentDragElement.style.top = top + 'px';
                currentDragElement.style.bottom = 'auto';
                
                // Kediler üzerinde mi kontrol et
                checkDropOnKedi(e.clientX, e.clientY);
            }
        }

        function dragEnd(e) {
            // Sadece mouse için
            if (e.type === 'mouseup' && isDragging && currentDragElement) {
                currentDragElement.classList.remove('dragging');
                currentDragElement.style.zIndex = '15';
                resetItemPosition(currentDragElement);
                isDragging = false;
                currentDragElement = null;
            }
        }

        function dragOver(e) {
            e.preventDefault();
        }

        function drop(e) {
            e.preventDefault();
            if (!draggedElement || !oyunAktif) return;
            
            const kedi = this.classList.contains('rifki') ? 'rifki' : 'istanbul';
            const istekTuru = kedilerinIstekleri[kedi];
            
            // Eğer kedinin bir isteği yoksa, bir şey yapma
            if (!istekTuru) return;
            
            let dogruCevap = false;
            let yanlisCevap = false;
            
            // Doğru eşleşme kontrolü
            if (draggedElement.classList.contains('mama-kabi') && istekTuru === 'acikti') {
                dogruCevap = true;
            } else if (draggedElement.classList.contains('su-kabi') && istekTuru === 'susadi') {
                dogruCevap = true;
            } else {
                yanlisCevap = true;
            }
            
            if (dogruCevap) {
                // Doğru eşleşme durumunda
                const basariliMesaj = anneCevaplari.basarili[Math.floor(Math.random() * anneCevaplari.basarili.length)];
                konusmaBalonuOlustur(this, basariliMesaj, 'basarili');
                // Anne afiyet olsun desin
                setTimeout(() => {
                    if (!oyunAktif) return;
                    const anneElement = document.querySelector('.husnanur');
                    const afiyetMesaj = anneCevaplari.afiyet[Math.floor(Math.random() * anneCevaplari.afiyet.length)];
                    konusmaBalonuOlustur(anneElement, afiyetMesaj, 'anne-cevap');
                }, 1500);
                // Skoru artır
                skor += 10 * seviye;
                document.getElementById('skor').textContent = skor;
                // Süreyi artır
                sure += 5;
                document.getElementById('sure').textContent = sure;
                // İsteği sıfırla
                delete kedilerinIstekleri[kedi];
                // Bu kedinin timer'ını da temizle
                if (istekTimers[kedi]) {
                    clearTimeout(istekTimers[kedi]);
                    delete istekTimers[kedi];
                }
                // Teşekkür ettikten hemen sonra yeni istek gelsin
                setTimeout(() => {
                    if (oyunAktif) yeniIstek(kedi);
                }, 1600);
                karsilananIstekSayisi++;
            } else if (yanlisCevap) {
                // Yanlış eşleşme durumunda
                const hataliMesaj = anneCevaplari.hatali[Math.floor(Math.random() * anneCevaplari.hatali.length)];
                konusmaBalonuOlustur(this, hataliMesaj, 'hatali');
                
                // Anne özür dilesin
                setTimeout(() => {
                    if (!oyunAktif) return;
                    const anneElement = document.querySelector('.husnanur');
                    const ozurMesaj = anneCevaplari.ozur[Math.floor(Math.random() * anneCevaplari.ozur.length)];
                    konusmaBalonuOlustur(anneElement, ozurMesaj, 'ozur');
                }, 1500);
                
                // Skoru azalt
                skor = Math.max(0, skor - 5);
                document.getElementById('skor').textContent = skor;
                
                // Süreyi azalt
                sure = Math.max(1, sure - 2);
                document.getElementById('sure').textContent = sure;
            }
            
            // Her durumda kabı orijinal yerine döndür
            if (draggedElement.classList.contains('mama-kabi')) {
                draggedElement.style.left = orijinalPozisyonlar.mama.left;
                draggedElement.style.top = orijinalPozisyonlar.mama.top;
                draggedElement.style.bottom = orijinalPozisyonlar.mama.bottom;
            } else if (draggedElement.classList.contains('su-kabi')) {
                draggedElement.style.left = orijinalPozisyonlar.su.left;
                draggedElement.style.top = orijinalPozisyonlar.su.top;
                draggedElement.style.bottom = orijinalPozisyonlar.su.bottom;
            }
            
            draggedElement.classList.remove('dragging');
            draggedElement = null;
            touchDragging = false;
        }

        function guncelleHUD() {
            document.getElementById('skor').textContent = skor;
            document.getElementById('sure').textContent = sure;
            document.getElementById('seviye').textContent = seviye;
        }

        function oyunBitir() {
            oyunAktif = false;
            
            // Tüm timer'ları temizle
            Object.values(istekTimers).forEach(timer => clearTimeout(timer));
            istekTimers = {};
            
            document.getElementById('finalSkor').textContent = skor;
            document.getElementById('gameOver').style.display = 'block';
            
            // ANNEEEEEG sesi (metin) - rastgele game over mesajları
            const gameOverMesajlari = [
                "ANNEEEEEG! Zaman bitti!",
                "ANNEEEEEG! Oyun bitti kediler aç kaldı!",
                "ANNEEEEEG! Kediler çok üzgün!",
                "ANNEEEEEG! Anne çok yavaştın!"
            ];
            const husnanur = document.querySelector('.husnanur');
            const randomMesaj = gameOverMesajlari[Math.floor(Math.random() * gameOverMesajlari.length)];
            konusmaBalonuOlustur(husnanur, randomMesaj, 'hatali');
        }

        function yeniOyun() {
            skor = 0;
            sure = 30;
            seviye = 1;
            oyunAktif = true;
            oyunBasladi = true;
            kedilerinIstekleri = {};
            kullanilmisPozisyonlar = [];
            
            // Önceki timer'ları temizle
            Object.values(istekTimers).forEach(timer => clearTimeout(timer));
            istekTimers = {};
            
            document.getElementById('gameOver').style.display = 'none';
            guncelleHUD();
            karsilananIstekSayisi = 0;
            
            // Kedileri farklı rastgele konumlandır
            rastgelePozisyon(kediElementleri.rifki, 'rifki');
            rastgelePozisyon(kediElementleri.istanbul, 'istanbul');
            
            // Oyun başlangıç mesajı
            const husnanur = document.querySelector('.husnanur');
            setTimeout(() => {
                konusmaBalonuOlustur(husnanur, "Merhaba kedilerim! Anne burada, size bakacağım!", 'anne-cevap');
            }, 1000);
            
            // İlk istekleri başlat - her iki kedi için de
            setTimeout(() => {
                if (oyunAktif) yeniIstek('rifki');
            }, 2000);
            
            setTimeout(() => {
                if (oyunAktif) yeniIstek('istanbul');
            }, 3500);
            
            oyunDongusu();
        }

        function oyunDongusu() {
            if (!oyunAktif) return;

            // Süre sayacı
            const sureInterval = setInterval(() => {
                if (!oyunAktif) {
                    clearInterval(sureInterval);
                    return;
                }
                
                sure--;
                guncelleHUD();
                
                if (sure <= 0) {
                    clearInterval(sureInterval);
                    oyunBitir();
                }
            }, 1000);

            // Her kedi için ayrı timer sistemi
            function kediyeIstekVer(kedi) {
                if (!oyunAktif) return;
                
                // Eğer kedinin aktif bir isteği yoksa ve timer'ı yoksa
                if (!kedilerinIstekleri[kedi] && !istekTimers[kedi]) {
                    // 3-7 saniye arası rastgele gecikme
                    const gecikme = 3000 + Math.random() * 4000;
                    
                    istekTimers[kedi] = setTimeout(() => {
                        if (oyunAktif && !kedilerinIstekleri[kedi]) {
                            yeniIstek(kedi);
                        }
                        delete istekTimers[kedi];
                        
                        // Bir sonraki istek için yeni timer kur
                        setTimeout(() => {
                            kediyeIstekVer(kedi);
                        }, 1000);
                    }, gecikme);
                }
            }

            // Her iki kedi için de ayrı döngü başlat
            setTimeout(() => kediyeIstekVer('rifki'), 1000);
            setTimeout(() => kediyeIstekVer('istanbul'), 2000);

            // Seviye artırma
            const seviyeInterval = setInterval(() => {
                if (!oyunAktif) {
                    clearInterval(seviyeInterval);
                    return;
                }
                
                const yeniSeviye = Math.floor(skor / 50) + 1;
                if (yeniSeviye > seviye) {
                    seviye = yeniSeviye;
                    guncelleHUD();
                    
                    const husnanur = document.querySelector('.husnanur');
                    konusmaBalonuOlustur(husnanur, `Seviye ${seviye}! Harika gidiyorsun!`, 'basarili');
                }
            }, 2000);
        }

        // DOM yüklendiğinde orijinal pozisyonları kaydet
        window.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.item').forEach(item => {
                orijinalPozisyonlar[item.classList.contains('mama-kabi') ? 'mama' : 'su'] = {
                    left: item.style.left,
                    top: item.style.top,
                    bottom: item.style.bottom
                };
            });
        });

                // Event listener'ları güncelle
        document.addEventListener('DOMContentLoaded', () => {
            const items = document.querySelectorAll('.item');
            
            items.forEach(item => {
                // Touch events (mobil)
                item.addEventListener('touchstart', handleTouchStart, { passive: false });
                
                // Mouse events (masaüstü)
                item.addEventListener('mousedown', dragStart);
            });

            // Global events
            document.addEventListener('touchmove', handleTouchMove, { passive: false });
            document.addEventListener('touchend', handleTouchEnd, { passive: false });
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);

            document.querySelectorAll('.kedi').forEach(kedi => {
                kedi.addEventListener('click', kediTikla);
                kedi.addEventListener('touchend', kediTikla);
            });
        });

        // Oyunu başlat - Sayfa yüklendiğinde
        window.addEventListener('load', () => {
            // Biraz bekleyip oyunu başlat
            setTimeout(() => {
                yeniOyun();
            }, 500);
        });
    </script>
</body>
</html>